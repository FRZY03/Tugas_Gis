<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map Click with AJAX</title>
  <style>
    #map {
      height: 100vh;
      /* Fullscreen height */
      width: 100%;
      /* Fullscreen width */
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder@2.0.1/dist/Control.Geocoder.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder@2.0.1/dist/Control.Geocoder.css" />
</head>

<body>

  <div id="map"></div>

  <script>
    // Inisialisasi peta
    var map = L.map('map').setView([-0.8871595143462079, 119.86048290907013], 13);

    // Menambahkan layer OpenStreetMap
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Menambahkan geocoder untuk pencarian lokasi
    L.Control.geocoder().addTo(map);

    // Menambahkan event listener untuk klik pada peta
    map.on('click', function (e) {
      const lat = e.latlng.lat;
      const lng = e.latlng.lng;

      // Menampilkan alert dengan latitude dan longitude
      alert(`You clicked the map at latitude: ${lat} and longitude: ${lng}`);

      // AJAX Request untuk mengirim data latitude dan longitude
      $.ajax({
        url: '/your-endpoint', // Ganti dengan URL endpoint yang sesuai
        method: 'POST',
        data: {
          id_wilayah: '1',  // Sesuaikan dengan ID wilayah yang relevan
          longitude: lng,
          latitude: lat
        },
        success: function (result) {
          console.log('Data successfully sent: ', result);
        },
        error: function (e) {
          alert('Error: ' + JSON.stringify(e));
        }
      });
    });

    // Fitur geolokasi browser
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        var userLat = position.coords.latitude;
        var userLng = position.coords.longitude;

        // Set view ke lokasi pengguna
        map.setView([userLat, userLng], 13);

        // Tambahkan marker di lokasi pengguna
        L.marker([userLat, userLng]).addTo(map)
          .bindPopup('You are here!')
          .openPopup();
      }, function () {
        alert('Geolocation failed or is not supported by this browser.');
      });
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  </script>

</body>

</html>